# プログラミングの作法

<a id="introduction"></a>
### 講義概要

本講義では、効果的なプログラミングの実践方法について学びます。プログラミングの作法には、上から攻める方法（Githubからクローンしてくる）と下から攻める方法（0から作成する）があります。また、TDDによるテストコード作成や、自然言語プログラミングの手法など、実践的なスキルを身につけていきます。さらに、オブジェクト指向の基本概念についても理解を深めます。


| 上から攻める | 下から攻める |
|--------------|--------------|
| - Githubなどのリポジトリからプロジェクトをクローンすることで、既存のコードを活用できる<br>- クローンしたコードを理解し、必要に応じて修正・改善を行う<br>- 他者が書いたコードを学習することで、自身のプログラミングスキルを向上できる | - 自分でプロジェクトを立ち上げ、ローカル環境からコードを書いていく<br>- 自分で考えながらプログラムを設計・実装することで、深い理解が得られる<br>- 自分で作ったコードに愛着が湧き、より良いものを作り上げようとする |



<a id="top-down-approach"></a>
### 上から攻める: Githubからクローンしてくる
- Githubなどのリポジトリからプロジェクトをクローンすることで、既存のコードを活用できる
- クローンしたコードを理解し、必要に応じて修正・改善を行う
- 他者が書いたコードを学習することで、自身のプログラミングスキルを向上できる

- 例題: Difyのリポジトリ（https://github.com/langgenius/dify）をクローンし、コードを理解する
   - Difyは、オープンソースの大規模言語モデル（LLM）アプリケーション開発プラットフォームです
   - Backend-as-a-ServiceとLLMOpsの概念を組み合わせ、開発者が実稼働グレードの生成AIアプリケーションを迅速に構築できるようにします
   - 使いやすいインターフェイスとAPIを提供しながら、LLMアプリケーション構築に必要な主要なテクノロジースタックを統合しています


<a id="bottom-up-approach"></a>
### 下から攻める: ローカル環境から作成する
- 自分でプロジェクトを立ち上げ、ローカル環境からコードを書いていく
- 自分で考えながらプログラムを設計・実装することで、深い理解が得られる
- 自分で作ったコードに愛着が湧き、より良いものを作り上げようとする


```md
# 癒しの猫ロボットシステム

## ゴール: 猫ロボットが癒してくれるシステムつくりたい

## 1. 目的
このシステムは、癒し効果のある猫ロボットを提供することで、ユーザーの心を癒し、ストレス解消や気分転換を促すことを目的とする。

## 2. ファイル・フォルダ構成
.
├── src
│   ├── main
│   │   ├── java
│   │   │   └── com
│   │   │       └── example
│   │   │           ├── cat
│   │   │           │   ├── Cat.java
│   │   │           │   ├── CatBehavior.java
│   │   │           │   └── CatMotor.java
│   │   │           ├── controller
│   │   │           │   └── CatController.java
│   │   │           ├── sensor
│   │   │           │   └── SensorManager.java
│   │   │           └── system
│   │   │               └── CatRobotSystem.java
│   │   └── resources
│   └── test
│       └── java
│           └── com
│               └── example
│                   └── CatRobotSystemTest.java
└── README.md

## 3. クラス図
+---------------+         +---------------+
|   CatRobot     |         |  CatBehavior  |
+---------------+         +---------------+
| - catName: String       | - purr(): void |
| - energy: int           | - meow(): void |
| - mood: int             | - sleep(): void|
+---------------+         +---------------+
       ^                           ^
       |                           |
+---------------+         +---------------+
|    CatMotor   |         |   SensorManager|
+---------------+         +---------------+
| - move(): void|         | - detectMotion()|
| - play(): void|         | - detectSound() |
| - rest(): void|         +---------------+
+---------------+                ^
       ^                         |
+---------------+         +---------------+
| CatController |         |     Cat       |
+---------------+         +---------------+
| - updateCat() |         | - energy: int  |
| - interact()  |         | - mood: int    |
+---------------+         | - behaviors: CatBehavior|
                          +---------------+

## 4. クラスの詳細

### CatRobot
- 説明: 猫ロボットの本体を表すクラス
- 属性:
  - catName: String - ロボットの名前
  - energy: int - ロボットの現在のエネルギー量
  - mood: int - ロボットの現在の機嫌
- 操作:
  - なし

### CatBehavior
- 説明: 猫ロボットの行動を表すクラス
- 属性:
  - なし
- 操作:
  - purr(): void - 喉を鳴らす
  - meow(): void - 鳴く
  - sleep(): void - 眠る

### CatMotor
- 説明: 猫ロボットの動作を制御するクラス
- 属性:
  - なし
- 操作:
  - move(): void - 移動する
  - play(): void - 遊ぶ
  - rest(): void - 休む

### SensorManager
- 説明: 猫ロボットの外部センサーを管理するクラス
- 属性:
  - なし
- 操作:
  - detectMotion(): void - 動きを検知する
  - detectSound(): void - 音を検知する

### CatController
- 説明: 猫ロボットの状態を管理し、ユーザーとの対話を制御するクラス
- 属性:
  - なし
- 操作:
  - updateCat(): void - 猫ロボットの状態を更新する
  - interact(): void - ユーザーとの対話を行う

### Cat
- 説明: 猫ロボットの状態を表すクラス
- 属性:
  - energy: int - 現在のエネルギー量
  - mood: int - 現在の機嫌
  - behaviors: CatBehavior - 行動パターン
- 操作:
  - なし

## 5. ユースケース
1. ユーザーが猫ロボットを起動する
   - 関連クラス: CatRobotSystem, CatController
   - 関連メソッド: CatController.updateCat(), CatController.interact()

2. ユーザーが猫ロボットと触れ合う
   - 関連クラス: CatController, CatRobot, CatMotor, SensorManager
   - 関連メソッド: SensorManager.detectMotion(), SensorManager.detectSound(), CatMotor.move(), CatMotor.play(), CatController.interact()

3. 猫ロボットが自発的に行動する
   - 関連クラス: CatRobot, CatBehavior, CatMotor
   - 関連メソッド: CatBehavior.purr(), CatBehavior.meow(), CatBehavior.sleep(), CatMotor.move(), CatMotor.rest()

4. 猫ロボットの状態が変化する
   - 関連クラス: CatRobot, Cat
   - 関連メソッド: CatController.updateCat()

## 6. シーケンス図

### ユースケース1: ユーザーが猫ロボットを起動する

+---------------+   +---------------+   +---------------+
| CatRobotSystem|   | CatController |   |    CatRobot    |
+---------------+   +---------------+   +---------------+
       |                   |                    |
       | createCatRobot()   |                    |
       |------------------>|                    |
       |                   | new CatRobot()     |
       |                   |------------------>|
       |                   |                    | init()
       |                   |                    |------------------>
       |                   |                    |                  
       |                   | updateCat()        |
       |                   |------------------>|
       |                   |                    |
       |                   | interact()         |
       |                   |------------------>|
       |                   |                    |
       |<------------------|                    |
       |                   |                    |

### ユースケース2: ユーザーが猫ロボットと触れ合う
+---------------+   +---------------+   +---------------+   +---------------+
| CatController |   |  SensorManager|   |    CatMotor    |   |    CatRobot    |
+---------------+   +---------------+   +---------------+   +---------------+
       |                   |                    |                    |
       | interact()        |                    |                    |
       |------------------>|                    |                    |
       |                   | detectMotion()     |                    |
       |                   |------------------>|                    |
       |                   |                    | move()             |
       |                   |                    |------------------>|
       |                   | detectSound()      |                    |
       |                   |------------------>|                    |
       |                   |                    | play()             |
       |                   |                    |------------------>|
       |                   |                    |                    |
       |<------------------|                    |                    |
       |                   |                    |                    |

### ユースケース3: 猫ロボットが自発的に行動する
+---------------+   +---------------+   +---------------+
|    CatRobot    |   |  CatBehavior  |   |    CatMotor    |
+---------------+   +---------------+   +---------------+
       |                   |                    |
       | updateState()     |                    |
       |------------------>|                    |
       |                   | purr()             |
       |                   |------------------>|
       |                   |                    | move()
       |                   |                    |------------------>
       |                   | meow()             |
       |                   |------------------>|
       |                   |                    | play()
       |                   |                    |------------------>
       |                   | sleep()            |
       |                   |------------------>|
       |                   |                    | rest()
       |                   |                    |------------------>
       |                   |                    |
       |<------------------|                    |
       |                   |                    |

以上が、猫ロボットシステムの要件定義書となります。オブジェクト指向の原則に基づいて設計されており、各クラスの役割と責任が明確に分離されています。また、ユースケースとシーケンス図を通して、システムの主要な動作が示されています。

```

<a id="tdd"></a>
### テストコード: TDD
TDDの具体的な手順は以下の通りです。

1. テストコードを書く
   ```python
   def test_add():
       assert add(1, 2) == 3
       assert add(0, 0) == 0
       assert add(-1, 1) == 0
   ```

2. テストを実行し、失敗することを確認する
   ```
   $ pytest test_add.py
   ========================= test session starts ==========================
   platform linux -- Python 3.8.10, pytest-7.1.2, pluggy-1.0.0
   rootdir: /home/user/project
   collected 1 item                                                      
   
   test_add.py F                                                    [100%]
   
   ================================ FAILURES ===============================
   ________________________________ test_add ________________________________
   
       def test_add():
   >       assert add(1, 2) == 3
   E       NameError: name 'add' is not defined
   
   test_add.py:2: NameError
   ======================= short test summary info ========================
   FAILED test_add.py::test_add - NameError: name 'add' is not defined
   ======================== 1 failed in 0.04s =============================
   ```

3. テストを通過させるための最小限の実装を行う
   ```python
   def add(a, b):
       return a + b
   ```

4. テストを再度実行し、成功することを確認する
   ```
   $ pytest test_add.py
   ========================= test session starts ==========================
   platform linux -- Python 3.8.10, pytest-7.1.2, pluggy-1.0.0
   rootdir: /home/user/project
   collected 1 item                                                      
   
   test_add.py .                                                    [100%]
   
   ========================== 1 passed in 0.01s ===========================
   ```

5. リファクタリングを行う
   ```python
   def add(a, b):
       ```2つの数値を加算する```
       return sum([a, b])
   ```

6. テストを再度実行し、成功することを確認する

このようにTDDでは、テストコードを先に書くことで、実装すべき機能を明確にし、
バグの早期発見とリファクタリングを容易にします。




<a id="examples-and-exercises"></a>
### 例題と演習
各トピックについて、以下の例題と演習を行います。

1. **上から攻める: Githubからクローンしてくる**
   - 例題: Difyのリポジトリ（https://github.com/langgenius/dify）をクローンし、コードを理解する
     - Difyは、オープンソースの大規模言語モデル（LLM）アプリケーション開発プラットフォームです
     - Backend-as-a-ServiceとLLMOpsの概念を組み合わせ、開発者が実稼働グレードの生成AIアプリケーションを迅速に構築できるようにします
     - 使いやすいインターフェイスとAPIを提供しながら、LLMアプリケーション構築に必要な主要なテクノロジースタックを統合しています

2. **下から攻める: ローカル環境から作成する**
   - 例題: 簡単なWebアプリケーションをローカル環境から作成する
      - zoltraak コマンドを利用する
      
   - 演習: 自分で設計・実装したプログラムをリファクタリングする


<a id="glossary"></a>
### 用語集

| 用語 | 説明 |
|------|------|
| クローン | Githubなどのリモートリポジトリから、ローカル環境にプロジェクトをコピーすること |
| TDD | Test-Driven Developmentの略。テストコードを先に書いてから実装する開発手法 |
| ドキュメントプログラミング | プログラムの動作を説明するドキュメントを生成すること |
| クラス | オブジェクト指向プログラミングにおける設計図のようなもの |
| インスタンス | クラスから生成されたオブジェクト |
| カプセル化 | データとそれを操作するメソッドをまとめて管理すること |
| 継承 | 既存のクラスの特性を引き継ぐこと |
| ポリモーフィズム | 同じ名称のメソッドが、クラスによって異なる動作をすること |
